option(USE_SYSTEM_YAML_CPP "Use the yaml-cpp library provided by the system" ON)

if(${USE_SYSTEM_YAML_CPP})
    find_package(yaml-cpp REQUIRED)
else(${USE_SYSTEM_YAML_CPP})
    include(ExternalProject)

    set(YAML_INSTALL_DIR ${CMAKE_CURRENT_BINARY_DIR}/yaml-cpp)

    ExternalProject_Add(Yaml-cpp
        PREFIX yaml-cpp
        GIT_REPOSITORY https://github.com/jbeder/yaml-cpp.git
        CMAKE_ARGS -DYAML_CPP_BUILD_CONTRIB=OFF -DYAML_CPP_BUILD_TOOLS=OFF -DBUILD_SHARED_LIBS=OFF -DMSVC_SHARED_RT=OFF -DMSVC_STHREADED_RT=OFF -Dgtest_force_shared_crt=OFF -DAPPLE_UNIVERSAL_BIN=OFF -DCMAKE_INSTALL_PREFIX=${YAML_INSTALL_DIR}
        INSTALL_DIR ${YAML_INSTALL_DIR}
        UPDATE_COMMAND ""
        )

    set(YAML_CPP_INCLUDE_DIRS ${YAML_INSTALL_DIR}/include)
    set(YAML_CPP_LIBRARIES ${YAML_INSTALL_DIR}/lib/libyaml-cpp.a)
    set(YAML_CPP_LIBRARY_DIRS ${YAML_INSTALL_DIR}/lib)
endif(${USE_SYSTEM_YAML_CPP})

add_library(yaml-3rd INTERFACE)
target_include_directories(yaml-3rd INTERFACE ${YAML_CPP_INCLUDE_DIRS})
target_link_libraries(yaml-3rd INTERFACE ${YAML_CPP_LIBRARIES})

if(NOT ${USE_SYSTEM_YAML_CPP})
    add_dependencies(yaml-3rd Yaml-cpp)
endif()
